(()=>{function e(){return window.unifiedSDK}function t(...t){return e().runSync(...t)}function n(e=null){const t={},r=new Set;let i,a=!1;return Object.defineProperty(t,"__isObservable",{value:!0,writable:!1,enumerable:!1,configurable:!1}),t.subscribe=n=>{if("function"!=typeof n)throw new Error("Invalid Argument: subscribe needs to be called with a function");return r.add(n),a||(a=!0,"function"==typeof e&&(i=e(t.next))),()=>{if(r.delete(n),0===r.size)return t.dispose()}},t.next=e=>{const t=[];return r.forEach((n=>{t.push(n(e))})),Promise.all(t)},t.pipe=(...e)=>{if(0===e.length)throw new Error("No pipe callback provided");let r=t;return e.forEach((e=>{if("function"!=typeof e)throw new Error("Invalid Argument: pipe can only be called with functions");const t=r;r=n((n=>t.subscribe((t=>e(t,n)))))})),r},t.dispose=async()=>{r.clear(),a=!1,i instanceof Promise&&(i=await i),"function"==typeof i&&await i()},t}function r(...e){return n((t=>{const n=e.map((e=>e.subscribe(t)));return()=>{n.forEach((e=>e()))}}))}function i(e,t,...r){return n((n=>{const i=e=>{try{n(e)}catch(e){}};return t.forEach((t=>e.addEventListener(t,i,...r))),()=>{t.forEach((t=>e.removeEventListener(t,i)))}}))}function a(e){let t,n=[];return(r,i)=>{n.push(r),clearTimeout(t),t=setTimeout((()=>{i(n),n=[]}),e)}}function o(e){return new Proxy(e,{set:()=>!0,get:(e,t)=>{const n=e[t];return"object"==typeof n&&null!==n?o(n):n}})}function s(e,t){return t.pipe((async(t,n)=>{if(e.state.initialized){const t=function(e){let t=0,n=0;return Object.values(e).filter((e=>e.enabled)).forEach((e=>{n+=e.weight;let r=e.events.length;if(r>0){let n=r;if(e.fadeTime&&"number"==typeof e.fadeTime&&e.fadeTime>0){r=0,n=0;const t=Date.now();e.events.forEach((i=>{const a=t-i.timestamp;a<=e.fadeTime&&(r++,n+=1-a/e.fadeTime)}))}if(1==e.minThreshold&&1==e.maxThreshold)t+=1/e.weight;else if(n>=e.maxThreshold)t+=Math.min(1,n/e.maxThreshold);else if(r>=e.minThreshold){const r=e.minThreshold-e.minThreshold/e.maxThreshold,i=n-r,a=e.maxThreshold-e.minThreshold,o=Math.max(0,i/a),s=Math.min(1,o*e.weight);t+=s}}})),n?t/n:0}(e.state.indicators);t!=e.getScore()&&n({type:"liveScore",data:{group:e.state.groupName,score:t}})}}))}function c(t,n){const i={},a={groupName:t,enabled:n.enabled,initialized:!1,indicators:n.indicators,severityLevel:n.severityLevel,score:0,maxScore:0,lastSeverityLevel:null};let c=null;i.state=o(a);const l=function(t){const n={},r={groupName:t,pageChangePersistence:!1,initialized:!1,indicators:{}};n.state=o(r);let i,a,s=null,c=null;return n.initialize=async t=>{({loader:i,logger:a}=e()),r.pageChangePersistence=t,t&&([c]=await i.requireModules(["database"])),r.initialized=!0},n.checkDatabaseConnection=async()=>{if(!c)return!1;let e=!1;try{await c.connectModule("scoringState"),e=!0}catch(e){a.warn("Connecting to indexed database failed, indicators for live scoring can not be persisted",e),c=null}return e},n.persistIndicators=async e=>{r.indicators={...e},s=setTimeout(n.persistIndicatorsWithTimeout,500)},n.persistIndicatorsWithTimeout=async()=>{if(r.pageChangePersistence&&await n.checkDatabaseConnection()){const e=c.getObjectStore("scoring");Object.entries(r.indicators).forEach((([t,n])=>{n.enabled&&n.pageChangePersistent&&e.put({indicator:t,events:n.events.filter((e=>e.currentPI)).map((e=>({timestamp:e.timestamp,currentPI:e.currentPI})))})}))}clearTimeout(s),s=null},n.restorePersistedIndicators=async e=>{if(r.pageChangePersistence&&await n.checkDatabaseConnection()){const t=c.getObjectStore("scoring"),n=async([e,n])=>{if(n.pageChangePersistent){const r=await t.get(e);r&&r.hasOwnProperty("events")&&r.events.length&&(n.events=r.events.map((e=>(e.currentPI=!1,e))))}};Object.entries(e).forEach(n)}return e},n.waitForPersistenceTimeout=async()=>{s&&await n.persistIndicatorsWithTimeout()},n.clearData=async()=>{if(r.pageChangePersistence&&await n.checkDatabaseConnection()){const e=c.getObjectStore("scoring");await e.clear()}},n}(t);let u=!1;return i.initialize=async(e,t,n)=>{Object.entries(e).forEach((([e,t])=>{a.indicators[e]={events:[],...a.indicators[e],...t},t.pageChangePersistent&&(u=!0)})),c=s(i,r(t,n.pipe((async(e,t)=>{await i.pageChangeReset(),t(e)})),i.getIndicatorObservables().pipe((e=>{i.updateIndicator(e.type,e.timestamp)})))).pipe(((e,t)=>{i.updateScore(e.data.score),t(e)})),await l.initialize(u,a.indicators),u&&(a.indicators=await l.restorePersistedIndicators(a.indicators)),a.initialized=!0},i.getObservable=()=>c,i.getIndicatorObservables=()=>r(...Object.values(a.indicators).filter((e=>e.enabled)).map((e=>e.observable))),i.getEnabledIndicators=()=>{const e={};return a.enabled&&Object.entries(a.indicators).forEach((([t,n])=>{n.enabled&&(e[t]=n)})),e},i.getScore=()=>a.score,i.updateScore=e=>{a.score=e},i.updateIndicator=(e,t)=>{const n=a.indicators.hasOwnProperty(e)?a.indicators[e]:null;if(n){if(n.events.push({timestamp:+t,currentPI:!0}),n.fadeTime&&"number"==typeof n.fadeTime&&n.fadeTime>0){const e=Date.now();n.events=n.events.filter((t=>e-t.timestamp<=n.fadeTime))}else n.maxThreshold&&n.events.length>n.maxThreshold&&(n.events=n.events.slice(-1*n.maxThreshold));l.persistIndicators(a.indicators)}},i.pageChangeReset=async()=>{await l.waitForPersistenceTimeout(),Object.values(a.indicators).forEach((e=>{e.events=[]})),a.indicators=await l.restorePersistedIndicators(a.indicators),l.persistIndicators(a.indicators),a.maxScore=a.score,a.lastSeverityLevel=i.getSeverityLevel()},i.getSeverityLevel=()=>{let e="none",t=0;return a.score>0&&Object.entries(a.severityLevel).forEach((([n,r])=>{a.score>=r&&r>t&&(t=r,e=n)})),e},i.getSeverityLevelRange=e=>{if(!e||!e.min&&!e.max)return!1;const t=!e.min||a.score>=a.severityLevel[e.min],n=!e.max||a.score<a.severityLevel[e.max];return t&&n},i.getMaxScoreObservable=()=>i.getObservable().pipe(((e,t)=>{if(e.data.score>a.maxScore){a.maxScore=e.data.score;const n={...e};n.data.severityLevel=i.getSeverityLevel(),t(n)}})),i.getSeverityChangeObservable=()=>i.getObservable().pipe(((e,t)=>{const n=i.getSeverityLevel();if(i.getSeverityLevel()!=a.lastSeverityLevel){a.lastSeverityLevel=n;const r={...e};r.data.severityLevel=i.getSeverityLevel(),t(r)}})),i.clearData=()=>{l.clearData()},i}function l(e){const t={clickRadius:e.clickRadius,clickThreshold:e.clickThreshold,timeWindow:e.timeWindow,lastClickEvents:[]};return i(document,["mousedown"]).pipe(((e,n)=>{const{pageX:r,pageY:i,timeStamp:a}=e,o={timeStamp:a,pageX:r,pageY:i},s=t.lastClickEvents[t.lastClickEvents.length-1]||null;if(s){const e=function(e,t,n,r,i){const a=Math.abs(e-n),o=Math.abs(t-r);return Math.max(a,o)<=i}(r,i,s.pageX,s.pageY,t.clickRadius);(o.timeStamp-s.timeStamp>t.timeWindow||!e)&&(t.lastClickEvents=[])}t.lastClickEvents.push(o),t.lastClickEvents.length===t.clickThreshold&&n({type:"rageClick",data:{clickCount:t.lastClickEvents.length},timestamp:Date.now()})}))}function u(e){let t=null,o=null;const s=i(document,["mousedown","touchstart"]).pipe((()=>{t=Date.now(),o=null})),c=r(i(document,["blur"]),i(document,["focus"],!0),function(e,t){return n((n=>{const r=new MutationObserver((e=>{e.forEach((e=>n({type:"mutation",mutation:e})))}));return r.observe(e,t),()=>r.disconnect()}))}(document,{childList:!0,attributes:!0,characterData:!0,subtree:!0})).pipe((()=>{o=Date.now()}));return r(s,c,i(document,["click"]).pipe(a(e.timeWindow))).pipe(((n,r)=>{if(null!==t&&null!==o){if(o-t<e.timeWindow)return}r({type:"deadClick",data:{},timestamp:Date.now()}),t=null,o=null}))}function d(e){return n((async t=>{const n=e.timeThreshold,r=function(){let e=0;if(performance&&"function"==typeof performance.getEntriesByType&&performance.getEntriesByType("navigation").length){const[t]=performance.getEntriesByType("navigation");e=Math.round(t.domComplete)}else performance&&"object"==typeof performance.timing&&(e=Math.round(performance.timing.domComplete-performance.timing.navigationStart));return e}();r>=n&&setTimeout((()=>{t({type:"pageRenderingTime",data:{domLoadTime:r},timestamp:Date.now()})}),10)}))}function p(){return i(window,["error"]).pipe(((e,t)=>{const{message:n,lineno:r,colno:i,filename:a}=e,o=`${r}:${i}`;(function(e){const t=/^https?:\/\/(localhost(:\d{1,5})?|([^/]+).verint-(cdn|api).com)\//;return Boolean(e.match(t))})(a)||t({type:"javaScriptErrors",data:{type:"error",message:n,line:o,scriptUrl:a},timestamp:Date.now()})}))}function g(t){const{loader:n}=e();return n.getModuleSync("visitor").getPageChangeObservable().pipe(((e,n)=>{(function(e,t){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;const n=t.find((t=>Boolean(e.match(new RegExp(t,"i")))));return Boolean(n)})(e.pagename,t.pagenames)&&setTimeout((()=>{n({type:"errorPage",data:{pagename:e.pagename},timestamp:Date.now()})}),10)}))}function m(t){const{loader:r}=e(),i=r.getModuleSync("visitor"),a=i.getPropertyObservable();return n((e=>(i.getProperties().forEach((n=>{f(n,t.properties)&&setTimeout((()=>{e({type:"errorMessage",data:{propertyName:n.name,propertyValue:n.value},timestamp:Date.now()})}),10)})),a.subscribe((n=>{f(n,t.properties)&&setTimeout((()=>{e({type:"errorMessage",data:{propertyName:n.name,propertyValue:n.value},timestamp:Date.now()})}),10)})))))}function f(e,t){if(!e?.name)return!1;if(!Array.isArray(t))return!1;let n=e.value;null==n&&(n="");const r=t.find((t=>"string"==typeof t?.name&&"string"==typeof t?.value&&Boolean(e.name.match(new RegExp(t.name,"i"))&&n.match(new RegExp(t.value,"i")))));return Boolean(r)}function b(){return document.scrollingElement||document.body.parentNode||document.body||document.documentElement}function h(){const e=b().scrollHeight-window.innerHeight;return Math.max(0,Math.min(b().scrollTop,e))}function v(e){const t=e.directionThreshold,n=e.minScrollLength;return function(){let e=null,t=null,n=null,r=0;return i(document,["scroll"]).pipe(((i,a)=>{const o=h();if(null===t)return void(t=o);const s=function(e,t){if(e>t)return"up";if(e<t)return"down";return"none"}(t,o);if(null===e)return e=s,void(n=Date.now());if("none"!==s){if(s===e)return r+=function(e,t){return Math.abs(e-t)}(t,o),void(t=o);a({direction:e,startTime:n,endTime:Date.now(),distance:r}),t=null,r=0,n=null,e=s}}))}().pipe(a(e.timeWindow)).pipe(((e,r)=>{const i=e.filter((e=>e.distance>=n));i.length>=t&&r({type:"highScrollActivity",data:{value:i.length},timestamp:Date.now()})}))}function y(e,t){return!(!e||"object"!=typeof e||"string"!=typeof e.tagName)&&(Array.isArray(t)?t.some((t=>y(e,t))):"string"==typeof t&&e.tagName.toUpperCase()===t.toUpperCase())}function w(e,t){return!(!e||"object"!=typeof e||!e.hasAttribute)&&e.hasAttribute(t)}function E(e){return!!y(e,["textarea","option","select"])||(!(!y(e,"input")||["button","submit","reset"].includes(e.type))||!!w(e,"contenteditable"))}function S(e){let t=null;return r(i(document,["focus"],!0).pipe((e=>{t=!E(e.target)||["button","radio","checkbox","color","file","image","range","reset","submit"].includes(e.target.type)?null:e.target})),i(document,["keyup"]).pipe(a(e.timeWindow))).pipe(((e,n)=>{Array.isArray(e)&&e[0].target==t?n({type:"longInputTime",data:{},timestamp:Date.now()}):t=null}))}function O(t){const{loader:n}=e(),o=n.getModuleSync("visitor").getPageChangeObservable();let s=[];return r(i(document,["focus"],!0).pipe((e=>{var t;!e.target||!E(e.target)||y(t=e.target,"input")&&"password"===t.type||(s.find((({element:t})=>t===e.target))||s.push({element:e.target,count:0}))})),o,i(document,["change"],!0),i(document,["input"],!0).pipe(a(t.inputDebounce))).pipe(((e,n)=>{if("pageChange"===e.type)return void(s=[]);if(Array.isArray(e)&&!w((e=e[0]).target,"contenteditable"))return;const r=s.find((({element:t})=>t===e.target));r&&(r.count++,r.count>=t.changeThreshold&&n({type:"formCorrection",data:{},timestamp:Date.now()}))}))}const{loader:T,config:C}=e();T.resolveModule("scoringEngine",(async()=>{const[i]=await T.requireModules(["visitor"]),a=i.getPageChangeObservable();var s;const f=function({heartbeatObservable:i,pageChangeObservable:a}){const{events:s,config:l}=e(),u={},d={groups:{},indicators:{},indicatorEvents:{},indicatorRegisterFNs:{},indicatorPageChangeInitialized:!1};return u.state=o(d),u.start=()=>{const e=l.getConfig("scoringEngine.indicators");Object.entries(e).forEach((([e,t])=>{u.prepareIndicator(e,t)}));const t=l.getConfig("scoringEngine.groups");Object.entries(t).forEach((([e,t])=>{u.prepareGroup(e,t)})),u.maxScoreUpdateSetProperty("struggle","Struggle"),s.triggerEvent("scoringEngine:ready",{scoringEngine:u})},u.stop=()=>{i.dispose(),a.dispose(),Object.values(d.indicators).forEach((e=>{e.enabled&&e.observable.dispose()})),Object.values(d.groups).forEach((e=>{e.state.enabled&&(e.getObservable().dispose(),e.clearData())}))},u.getState=()=>d,u.getHeartbeatObservable=()=>i,u.getPageChangeObservable=()=>a,u.prepareGroup=(e,t)=>{d.groups[e]=c(e,t);const n=d.groups[e];if(n.state.enabled){const t={};Object.entries(n.state.indicators).forEach((([n,r])=>{r.enabled&&(u.enableIndicator(n),t[n]={...r,...d.indicators[n]},d.indicators[n].hasOwnProperty("groups")||(d.indicators[n].groups=[]),d.indicators[n].groups.push(e))})),n.initialize(t,i,a)}},u.registerIndicator=(e,t)=>{d.indicatorRegisterFNs[e]=t},u.prepareIndicator=(e,t)=>{"function"==typeof d.indicatorRegisterFNs[e]&&(d.indicators[e]={enabled:!1,events:[],...t})},u.enableIndicator=e=>{d.indicators[e].enabled=!0,d.indicatorEvents[e]=[],d.indicators[e].observable=d.indicatorRegisterFNs[e](d.indicators[e]).pipe(((t,n)=>{t.timestamp=t.timestamp||Date.now(),t.groups=d.indicators[e].groups,d.indicatorEvents[e].push(t),n(t)})),d.indicators[e].getObservable=()=>r(d.indicators[e].observable,u.replayObservable(e))},u.getGroup=e=>d.groups[e]||null,u.getRunningGroups=()=>{const e={};return Object.entries(d.groups).forEach((([t,n])=>{n.state.enabled&&(e[t]=n)})),e},u.getIndicator=e=>{const t=d.indicators[e];return t.enabled||u.enableIndicator(e),t},u.getRunningIndicators=()=>{const e={};return Object.entries(d.indicators).forEach((([t,n])=>{n.enabled&&(e[t]=n)})),e},u.getRunningIndicatorsObservable=()=>r(...Object.values(u.getRunningIndicators()).map((e=>e.getObservable())),n()),u.indicatorPersistenceCleanup=()=>{d.indicatorPageChangeInitialized||(d.indicatorPageChangeInitialized=!0,a.subscribe((()=>{Object.values(d.indicators).forEach((e=>{e.events=[]}))})))},u.replayObservable=e=>{u.indicatorPersistenceCleanup();const t=n((n=>{d.indicatorEvents[e].forEach((t=>{n({type:e,timestamp:t.timestamp,data:t.data})})),t.dispose()}));return t},u.maxScoreUpdateSetProperty=(e,n)=>{const r=u.getGroup(e);r&&r.state.enabled&&r.getMaxScoreObservable().subscribe((e=>{const r=t("visitor.getPageManager");r.setProperty(`Live Score ${n}`,Math.round(100*e.data.score),{dataType:"int"}),r.setProperty(`Live Score ${n} Severity Level`,e.data.severityLevel)}))},u.getScoreSeverityChangeObservable=()=>{const e=u.getRunningGroups(),t=[n()];return Object.values(e).forEach((e=>{t.push(e.getSeverityChangeObservable())})),r(...t)},u}({heartbeatObservable:(s=C.getConfig("scoringEngine.heartbeat"),n((e=>{const t=setInterval((()=>e({type:"heartbeat"})),s);return()=>{clearInterval(t)}}))),pageChangeObservable:a});return f.registerIndicator("rageClick",l),f.registerIndicator("deadClick",u),f.registerIndicator("pageRenderingTime",d),f.registerIndicator("javaScriptErrors",p),f.registerIndicator("errorPage",g),f.registerIndicator("errorMessage",m),f.registerIndicator("highScrollActivity",v),f.registerIndicator("longInputTime",S),f.registerIndicator("formCorrection",O),f}))})();